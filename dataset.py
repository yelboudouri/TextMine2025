import json
import random
from collections import defaultdict

import pandas as pd
import torch
from torch.utils.data import Dataset
from transformers import BertTokenizer

from utils import clean_text, pad_sequence

ENTITY_CLASSES = ['HOOLIGANISM_TROUBLEMAKING', 'GROUP_OF_INDIVIDUALS', 'GATHERING', 'MATERIAL_REFERENCE',
                  'TERRORIST_OR_CRIMINAL', 'TIME_MIN', 'MATERIEL', 'INTERGOVERNMENTAL_ORGANISATION', 'STRIKE',
                  'THEFT', 'QUANTITY_MIN', 'POLITICAL_VIOLENCE', 'CIVIL_WAR_OUTBREAK', 'LATITUDE', 'COLOR',
                  'QUANTITY_FUZZY', 'CATEGORY', 'SUICIDE', 'HEIGHT', 'TIME_EXACT', 'WEIGHT', 'CRIMINAL_ARREST',
                  'LASTNAME', 'COUP_D_ETAT', 'TIME_FUZZY', 'WIDTH', 'FIRSTNAME', 'AGITATING_TROUBLE_MAKING',
                  'LONGITUDE', 'TIME_MAX', 'ECONOMICAL_CRISIS', 'DRUG_OPERATION', 'NON_GOVERNMENTAL_ORGANISATION',
                  'RIOT', 'NATIONALITY', 'ACCIDENT', 'DEMONSTRATION', 'ILLEGAL_CIVIL_DEMONSTRATION', 'FIRE',
                  'MILITARY', 'NON_MILITARY_GOVERNMENT_ORGANISATION', 'PLACE', 'QUANTITY_EXACT', 'CBRN_EVENT',
                  'POLLUTION', 'CIVILIAN', 'NATURAL_EVENT', 'LENGTH', 'ELECTION', 'QUANTITY_MAX', 'EPIDEMIC',
                  'NATURAL_CAUSES_DEATH', 'TRAFFICKING', 'BOMBING', 'MILITARY_ORGANISATION']
RELATION_CLASSES = ['NO_RELATION', 'HAS_COLOR', 'CREATED', 'WEIGHS', 'IS_LOCATED_IN', 'IS_COOPERATING_WITH',
                    'DEATHS_NUMBER', 'END_DATE', 'HAS_FOR_HEIGHT', 'HAS_QUANTITY', 'IS_BORN_ON', 'INJURED_NUMBER',
                    'HAS_CONTROL_OVER', 'IS_AT_ODDS_WITH', 'HAS_CATEGORY', 'IS_OF_SIZE', 'HAS_LONGITUDE',
                    'HAS_FAMILY_RELATIONSHIP', 'INITIATED', 'IS_PART_OF', 'HAS_FOR_WIDTH', 'RESIDES_IN',
                    'IS_DEAD_ON', 'GENDER_FEMALE', 'IS_IN_CONTACT_WITH', 'IS_BORN_IN', 'IS_REGISTERED_AS',
                    'START_DATE', 'WAS_CREATED_IN', 'HAS_LATITUDE', 'OPERATES_IN', 'HAS_CONSEQUENCE', 'GENDER_MALE',
                    'HAS_FOR_LENGTH', 'WAS_DISSOLVED_IN', 'IS_OF_NATIONALITY', 'STARTED_IN', 'DIED_IN']
POSSIBLE_ENTITIES_RELATIONS = ['STRIKE END_DATE TIME_EXACT',
                               'CIVILIAN IS_COOPERATING_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'BOMBING HAS_CONSEQUENCE ECONOMICAL_CRISIS', 'MILITARY GENDER_MALE MILITARY',
                               'CIVILIAN IS_COOPERATING_WITH MILITARY_ORGANISATION',
                               'CIVILIAN IS_IN_CONTACT_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'HOOLIGANISM_TROUBLEMAKING START_DATE TIME_EXACT',
                               'MILITARY_ORGANISATION IS_IN_CONTACT_WITH GROUP_OF_INDIVIDUALS',
                               'TERRORIST_OR_CRIMINAL INITIATED DRUG_OPERATION',
                               'NON_GOVERNMENTAL_ORGANISATION HAS_CONTROL_OVER CIVILIAN',
                               'SUICIDE END_DATE TIME_EXACT', 'MILITARY IS_PART_OF GROUP_OF_INDIVIDUALS',
                               'NATURAL_CAUSES_DEATH HAS_CONSEQUENCE ACCIDENT',
                               'INTERGOVERNMENTAL_ORGANISATION HAS_CONTROL_OVER NON_GOVERNMENTAL_ORGANISATION',
                               'MILITARY_ORGANISATION IS_AT_ODDS_WITH TERRORIST_OR_CRIMINAL',
                               'RIOT END_DATE TIME_FUZZY',
                               'MILITARY_ORGANISATION HAS_CONTROL_OVER GROUP_OF_INDIVIDUALS',
                               'ECONOMICAL_CRISIS HAS_CONSEQUENCE FIRE',
                               'GROUP_OF_INDIVIDUALS INITIATED CBRN_EVENT',
                               'MILITARY_ORGANISATION IS_IN_CONTACT_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'TERRORIST_OR_CRIMINAL IS_IN_CONTACT_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'NON_GOVERNMENTAL_ORGANISATION IS_IN_CONTACT_WITH MILITARY',
                               'PLACE HAS_LATITUDE LATITUDE', 'ACCIDENT START_DATE TIME_FUZZY',
                               'FIRE HAS_CONSEQUENCE FIRE', 'CIVILIAN INITIATED AGITATING_TROUBLE_MAKING',
                               'BOMBING END_DATE TIME_FUZZY', 'MILITARY IS_IN_CONTACT_WITH CIVILIAN',
                               'POLITICAL_VIOLENCE END_DATE TIME_EXACT',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION INITIATED NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'AGITATING_TROUBLE_MAKING HAS_CONSEQUENCE RIOT',
                               'CBRN_EVENT HAS_CONSEQUENCE GATHERING', 'GROUP_OF_INDIVIDUALS IS_LOCATED_IN PLACE',
                               'TERRORIST_OR_CRIMINAL IS_AT_ODDS_WITH MILITARY_ORGANISATION',
                               'NON_GOVERNMENTAL_ORGANISATION OPERATES_IN PLACE',
                               'ECONOMICAL_CRISIS START_DATE TIME_MIN',
                               'CIVILIAN IS_AT_ODDS_WITH MILITARY_ORGANISATION', 'GATHERING STARTED_IN PLACE',
                               'AGITATING_TROUBLE_MAKING START_DATE TIME_EXACT',
                               'GROUP_OF_INDIVIDUALS INITIATED COUP_D_ETAT',
                               'MILITARY_ORGANISATION INITIATED BOMBING',
                               'DEMONSTRATION HAS_CONSEQUENCE DEMONSTRATION', 'NATURAL_EVENT STARTED_IN PLACE',
                               'NATURAL_EVENT IS_LOCATED_IN PLACE',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION INITIATED GATHERING',
                               'GROUP_OF_INDIVIDUALS IS_IN_CONTACT_WITH GROUP_OF_INDIVIDUALS',
                               'TRAFFICKING START_DATE TIME_MAX',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_COOPERATING_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'GROUP_OF_INDIVIDUALS INITIATED DEMONSTRATION',
                               'AGITATING_TROUBLE_MAKING END_DATE TIME_FUZZY',
                               'GROUP_OF_INDIVIDUALS IS_OF_SIZE QUANTITY_EXACT',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION HAS_CONTROL_OVER PLACE',
                               'FIRE START_DATE TIME_FUZZY', 'ELECTION HAS_CONSEQUENCE RIOT',
                               'EPIDEMIC IS_LOCATED_IN PLACE', 'CIVILIAN IS_IN_CONTACT_WITH CIVILIAN',
                               'THEFT IS_LOCATED_IN PLACE', 'CIVILIAN HAS_CONTROL_OVER MATERIEL',
                               'CIVIL_WAR_OUTBREAK END_DATE TIME_EXACT', 'DEMONSTRATION STARTED_IN PLACE',
                               'MILITARY HAS_CONTROL_OVER NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'SUICIDE END_DATE TIME_FUZZY', 'CIVILIAN IS_COOPERATING_WITH CIVILIAN',
                               'GATHERING HAS_CONSEQUENCE AGITATING_TROUBLE_MAKING',
                               'GATHERING START_DATE TIME_EXACT', 'GROUP_OF_INDIVIDUALS INITIATED TRAFFICKING',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION INITIATED AGITATING_TROUBLE_MAKING',
                               'NON_GOVERNMENTAL_ORGANISATION IS_AT_ODDS_WITH CIVILIAN',
                               'GROUP_OF_INDIVIDUALS IS_AT_ODDS_WITH CIVILIAN', 'CIVILIAN IS_DEAD_ON TIME_MIN',
                               'CIVILIAN HAS_CONTROL_OVER MILITARY_ORGANISATION',
                               'CIVILIAN IS_IN_CONTACT_WITH MILITARY_ORGANISATION',
                               'MILITARY IS_PART_OF MILITARY_ORGANISATION', 'POLLUTION IS_LOCATED_IN PLACE',
                               'MILITARY IS_IN_CONTACT_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'INTERGOVERNMENTAL_ORGANISATION IS_AT_ODDS_WITH GROUP_OF_INDIVIDUALS',
                               'POLLUTION HAS_CONSEQUENCE POLLUTION',
                               'GROUP_OF_INDIVIDUALS IS_COOPERATING_WITH CIVILIAN',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_AT_ODDS_WITH TERRORIST_OR_CRIMINAL',
                               'CIVILIAN DIED_IN GATHERING',
                               'TERRORIST_OR_CRIMINAL IS_IN_CONTACT_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'AGITATING_TROUBLE_MAKING INJURED_NUMBER QUANTITY_FUZZY',
                               'RIOT HAS_CONSEQUENCE POLITICAL_VIOLENCE',
                               'POLITICAL_VIOLENCE START_DATE TIME_EXACT',
                               'DEMONSTRATION DEATHS_NUMBER QUANTITY_EXACT',
                               'GROUP_OF_INDIVIDUALS IS_OF_NATIONALITY NATIONALITY',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_OF_NATIONALITY NATIONALITY',
                               'SUICIDE STARTED_IN PLACE', 'NON_GOVERNMENTAL_ORGANISATION INITIATED STRIKE',
                               'TERRORIST_OR_CRIMINAL INITIATED HOOLIGANISM_TROUBLEMAKING',
                               'GROUP_OF_INDIVIDUALS HAS_CONTROL_OVER MATERIEL',
                               'CRIMINAL_ARREST START_DATE TIME_EXACT', 'RIOT DEATHS_NUMBER QUANTITY_FUZZY',
                               'NON_GOVERNMENTAL_ORGANISATION IS_OF_SIZE QUANTITY_EXACT',
                               'CIVILIAN IS_IN_CONTACT_WITH TERRORIST_OR_CRIMINAL',
                               'CBRN_EVENT INJURED_NUMBER QUANTITY_FUZZY',
                               'GROUP_OF_INDIVIDUALS IS_PART_OF GROUP_OF_INDIVIDUALS',
                               'POLITICAL_VIOLENCE END_DATE TIME_FUZZY',
                               'INTERGOVERNMENTAL_ORGANISATION OPERATES_IN PLACE',
                               'POLITICAL_VIOLENCE START_DATE TIME_MIN',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION WAS_CREATED_IN TIME_EXACT',
                               'NON_GOVERNMENTAL_ORGANISATION IS_AT_ODDS_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'GROUP_OF_INDIVIDUALS INITIATED RIOT', 'NATURAL_CAUSES_DEATH STARTED_IN PLACE',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_IN_CONTACT_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'MATERIEL HAS_FOR_WIDTH WIDTH', 'CBRN_EVENT END_DATE TIME_EXACT',
                               'NON_GOVERNMENTAL_ORGANISATION IS_AT_ODDS_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'AGITATING_TROUBLE_MAKING END_DATE TIME_EXACT',
                               'TERRORIST_OR_CRIMINAL INITIATED BOMBING', 'CIVILIAN INITIATED CBRN_EVENT',
                               'POLLUTION HAS_CONSEQUENCE CRIMINAL_ARREST', 'NATURAL_EVENT HAS_CONSEQUENCE THEFT',
                               'GROUP_OF_INDIVIDUALS IS_AT_ODDS_WITH MILITARY',
                               'NON_GOVERNMENTAL_ORGANISATION IS_COOPERATING_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'NON_GOVERNMENTAL_ORGANISATION HAS_CONTROL_OVER MATERIEL',
                               'CIVILIAN INITIATED SUICIDE', 'GROUP_OF_INDIVIDUALS INITIATED BOMBING',
                               'GROUP_OF_INDIVIDUALS IS_COOPERATING_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'MILITARY_ORGANISATION IS_PART_OF NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'BOMBING DEATHS_NUMBER QUANTITY_FUZZY',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_COOPERATING_WITH GROUP_OF_INDIVIDUALS',
                               'ILLEGAL_CIVIL_DEMONSTRATION END_DATE TIME_EXACT',
                               'MATERIEL HAS_QUANTITY QUANTITY_FUZZY',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_COOPERATING_WITH TERRORIST_OR_CRIMINAL',
                               'CIVILIAN INITIATED THEFT',
                               'GROUP_OF_INDIVIDUALS IS_COOPERATING_WITH GROUP_OF_INDIVIDUALS',
                               'GATHERING HAS_CONSEQUENCE RIOT', 'CIVIL_WAR_OUTBREAK INJURED_NUMBER QUANTITY_FUZZY',
                               'ILLEGAL_CIVIL_DEMONSTRATION IS_LOCATED_IN PLACE', 'BOMBING STARTED_IN PLACE',
                               'GROUP_OF_INDIVIDUALS IS_AT_ODDS_WITH INTERGOVERNMENTAL_ORGANISATION',
                               'CIVILIAN IS_PART_OF GROUP_OF_INDIVIDUALS',
                               'NON_GOVERNMENTAL_ORGANISATION INITIATED POLLUTION',
                               'NON_GOVERNMENTAL_ORGANISATION IS_IN_CONTACT_WITH INTERGOVERNMENTAL_ORGANISATION',
                               'NON_GOVERNMENTAL_ORGANISATION HAS_CONTROL_OVER TERRORIST_OR_CRIMINAL',
                               'MILITARY_ORGANISATION HAS_CONTROL_OVER PLACE', 'RIOT HAS_CONSEQUENCE GATHERING',
                               'TERRORIST_OR_CRIMINAL INITIATED ACCIDENT',
                               'ILLEGAL_CIVIL_DEMONSTRATION HAS_CONSEQUENCE THEFT',
                               'GROUP_OF_INDIVIDUALS IS_AT_ODDS_WITH TERRORIST_OR_CRIMINAL',
                               'ACCIDENT STARTED_IN PLACE', 'MATERIEL WAS_CREATED_IN TIME_MIN',
                               'POLLUTION HAS_CONSEQUENCE GATHERING',
                               'GROUP_OF_INDIVIDUALS IS_AT_ODDS_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'TERRORIST_OR_CRIMINAL INITIATED TRAFFICKING',
                               'GATHERING HAS_CONSEQUENCE NATURAL_EVENT', 'BOMBING DEATHS_NUMBER QUANTITY_EXACT',
                               'GROUP_OF_INDIVIDUALS CREATED NON_GOVERNMENTAL_ORGANISATION',
                               'FIRE HAS_CONSEQUENCE AGITATING_TROUBLE_MAKING',
                               'CRIMINAL_ARREST END_DATE TIME_EXACT', 'CBRN_EVENT INJURED_NUMBER QUANTITY_EXACT',
                               'CBRN_EVENT HAS_CONSEQUENCE POLLUTION', 'NATURAL_EVENT START_DATE TIME_EXACT',
                               'CRIMINAL_ARREST STARTED_IN PLACE', 'CIVIL_WAR_OUTBREAK HAS_CONSEQUENCE ACCIDENT',
                               'MILITARY_ORGANISATION INITIATED POLITICAL_VIOLENCE',
                               'GATHERING INJURED_NUMBER QUANTITY_FUZZY', 'CRIMINAL_ARREST END_DATE TIME_FUZZY',
                               'THEFT DEATHS_NUMBER QUANTITY_EXACT',
                               'TERRORIST_OR_CRIMINAL IS_AT_ODDS_WITH MILITARY',
                               'RIOT HAS_CONSEQUENCE AGITATING_TROUBLE_MAKING',
                               'TERRORIST_OR_CRIMINAL IS_COOPERATING_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'CRIMINAL_ARREST HAS_CONSEQUENCE BOMBING',
                               'GATHERING HAS_CONSEQUENCE ILLEGAL_CIVIL_DEMONSTRATION',
                               'INTERGOVERNMENTAL_ORGANISATION HAS_CONTROL_OVER GROUP_OF_INDIVIDUALS',
                               'GROUP_OF_INDIVIDUALS IS_IN_CONTACT_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_AT_ODDS_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'GROUP_OF_INDIVIDUALS IS_OF_SIZE QUANTITY_FUZZY',
                               'ILLEGAL_CIVIL_DEMONSTRATION HAS_CONSEQUENCE FIRE',
                               'NATURAL_EVENT END_DATE TIME_FUZZY', 'CIVILIAN DIED_IN NATURAL_EVENT',
                               'BOMBING HAS_CONSEQUENCE FIRE',
                               'CIVILIAN IS_IN_CONTACT_WITH INTERGOVERNMENTAL_ORGANISATION',
                               'DRUG_OPERATION HAS_CONSEQUENCE CRIMINAL_ARREST',
                               'TERRORIST_OR_CRIMINAL GENDER_FEMALE TERRORIST_OR_CRIMINAL',
                               'GROUP_OF_INDIVIDUALS INITIATED DRUG_OPERATION',
                               'NON_GOVERNMENTAL_ORGANISATION WAS_DISSOLVED_IN TIME_FUZZY',
                               'NON_GOVERNMENTAL_ORGANISATION IS_IN_CONTACT_WITH CIVILIAN',
                               'NON_GOVERNMENTAL_ORGANISATION IS_IN_CONTACT_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'ACCIDENT INJURED_NUMBER QUANTITY_MIN', 'CIVILIAN INITIATED DEMONSTRATION',
                               'CIVILIAN HAS_CONTROL_OVER GROUP_OF_INDIVIDUALS', 'THEFT END_DATE TIME_EXACT',
                               'NON_GOVERNMENTAL_ORGANISATION IS_IN_CONTACT_WITH GROUP_OF_INDIVIDUALS',
                               'GROUP_OF_INDIVIDUALS INITIATED AGITATING_TROUBLE_MAKING',
                               'BOMBING HAS_CONSEQUENCE DEMONSTRATION', 'ACCIDENT HAS_CONSEQUENCE CBRN_EVENT',
                               'CIVILIAN HAS_CONTROL_OVER NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'COUP_D_ETAT HAS_CONSEQUENCE FIRE',
                               'MILITARY_ORGANISATION IS_IN_CONTACT_WITH TERRORIST_OR_CRIMINAL',
                               'CIVILIAN IS_IN_CONTACT_WITH GROUP_OF_INDIVIDUALS',
                               'CBRN_EVENT HAS_CONSEQUENCE FIRE', 'RIOT START_DATE TIME_EXACT',
                               'ELECTION END_DATE TIME_EXACT', 'CIVILIAN IS_LOCATED_IN PLACE',
                               'POLITICAL_VIOLENCE HAS_CONSEQUENCE DEMONSTRATION',
                               'INTERGOVERNMENTAL_ORGANISATION IS_IN_CONTACT_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'CIVILIAN CREATED NON_GOVERNMENTAL_ORGANISATION',
                               'GROUP_OF_INDIVIDUALS INITIATED FIRE',
                               'THEFT HAS_CONSEQUENCE HOOLIGANISM_TROUBLEMAKING',
                               'CIVILIAN IS_AT_ODDS_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'POLLUTION START_DATE TIME_EXACT', 'TRAFFICKING HAS_CONSEQUENCE CRIMINAL_ARREST',
                               'CIVIL_WAR_OUTBREAK STARTED_IN PLACE',
                               'TERRORIST_OR_CRIMINAL HAS_FAMILY_RELATIONSHIP CIVILIAN',
                               'NON_GOVERNMENTAL_ORGANISATION IS_IN_CONTACT_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'AGITATING_TROUBLE_MAKING HAS_CONSEQUENCE CRIMINAL_ARREST',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION WAS_DISSOLVED_IN TIME_EXACT',
                               'CIVIL_WAR_OUTBREAK START_DATE TIME_EXACT', 'RIOT HAS_CONSEQUENCE STRIKE',
                               'CIVILIAN INITIATED RIOT', 'BOMBING INJURED_NUMBER QUANTITY_EXACT',
                               'MILITARY_ORGANISATION IS_COOPERATING_WITH CIVILIAN',
                               'CBRN_EVENT DEATHS_NUMBER QUANTITY_MAX', 'MATERIEL HAS_COLOR COLOR',
                               'POLITICAL_VIOLENCE HAS_CONSEQUENCE POLITICAL_VIOLENCE',
                               'CIVILIAN INITIATED EPIDEMIC', 'CIVILIAN HAS_FAMILY_RELATIONSHIP CIVILIAN',
                               'THEFT HAS_CONSEQUENCE CRIMINAL_ARREST', 'CBRN_EVENT DEATHS_NUMBER QUANTITY_FUZZY',
                               'MATERIEL WAS_CREATED_IN TIME_FUZZY',
                               'NON_GOVERNMENTAL_ORGANISATION INITIATED BOMBING',
                               'GROUP_OF_INDIVIDUALS STARTED_IN PLACE', 'FIRE STARTED_IN PLACE',
                               'NATURAL_EVENT HAS_CONSEQUENCE FIRE', 'GROUP_OF_INDIVIDUALS HAS_CONTROL_OVER PLACE',
                               'MILITARY IS_COOPERATING_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'CIVIL_WAR_OUTBREAK HAS_CONSEQUENCE COUP_D_ETAT', 'CBRN_EVENT IS_LOCATED_IN PLACE',
                               'TERRORIST_OR_CRIMINAL IS_LOCATED_IN PLACE',
                               'ECONOMICAL_CRISIS HAS_CONSEQUENCE TRAFFICKING',
                               'POLLUTION HAS_CONSEQUENCE DEMONSTRATION', 'FIRE INJURED_NUMBER QUANTITY_FUZZY',
                               'FIRE IS_LOCATED_IN PLACE', 'GATHERING HAS_CONSEQUENCE FIRE',
                               'EPIDEMIC HAS_CONSEQUENCE STRIKE',
                               'GROUP_OF_INDIVIDUALS IS_COOPERATING_WITH TERRORIST_OR_CRIMINAL',
                               'HOOLIGANISM_TROUBLEMAKING HAS_CONSEQUENCE THEFT',
                               'CIVILIAN IS_PART_OF NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'CRIMINAL_ARREST HAS_CONSEQUENCE RIOT', 'CBRN_EVENT START_DATE TIME_MIN',
                               'GROUP_OF_INDIVIDUALS IS_IN_CONTACT_WITH CIVILIAN',
                               'TERRORIST_OR_CRIMINAL INITIATED FIRE', 'BOMBING INJURED_NUMBER QUANTITY_FUZZY',
                               'FIRE HAS_CONSEQUENCE COUP_D_ETAT', 'THEFT HAS_CONSEQUENCE THEFT',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_AT_ODDS_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'ACCIDENT DEATHS_NUMBER QUANTITY_FUZZY',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_COOPERATING_WITH CIVILIAN',
                               'NATURAL_EVENT START_DATE TIME_MIN', 'ACCIDENT HAS_CONSEQUENCE STRIKE',
                               'GATHERING HAS_CONSEQUENCE BOMBING',
                               'POLITICAL_VIOLENCE INJURED_NUMBER QUANTITY_FUZZY',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_AT_ODDS_WITH CIVILIAN',
                               'NON_GOVERNMENTAL_ORGANISATION INITIATED DRUG_OPERATION',
                               'MILITARY_ORGANISATION INITIATED GATHERING',
                               'TERRORIST_OR_CRIMINAL IS_AT_ODDS_WITH TERRORIST_OR_CRIMINAL',
                               'CIVILIAN HAS_CONTROL_OVER PLACE',
                               'GROUP_OF_INDIVIDUALS IS_AT_ODDS_WITH GROUP_OF_INDIVIDUALS',
                               'TERRORIST_OR_CRIMINAL IS_PART_OF NON_GOVERNMENTAL_ORGANISATION',
                               'SUICIDE HAS_CONSEQUENCE GATHERING', 'MATERIEL IS_REGISTERED_AS MATERIAL_REFERENCE',
                               'ACCIDENT INJURED_NUMBER QUANTITY_EXACT', 'STRIKE HAS_CONSEQUENCE STRIKE',
                               'COUP_D_ETAT HAS_CONSEQUENCE AGITATING_TROUBLE_MAKING',
                               'ILLEGAL_CIVIL_DEMONSTRATION HAS_CONSEQUENCE RIOT', 'CIVILIAN DIED_IN CBRN_EVENT',
                               'DRUG_OPERATION STARTED_IN PLACE', 'MILITARY HAS_CONTROL_OVER MATERIEL',
                               'MATERIEL HAS_QUANTITY QUANTITY_EXACT', 'CBRN_EVENT STARTED_IN PLACE',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_IN_CONTACT_WITH MILITARY',
                               'MILITARY IS_COOPERATING_WITH CIVILIAN', 'CIVILIAN IS_AT_ODDS_WITH MILITARY',
                               'NON_GOVERNMENTAL_ORGANISATION WAS_CREATED_IN TIME_EXACT',
                               'MILITARY IS_IN_CONTACT_WITH TERRORIST_OR_CRIMINAL',
                               'AGITATING_TROUBLE_MAKING IS_LOCATED_IN PLACE', 'ACCIDENT START_DATE TIME_MIN',
                               'GROUP_OF_INDIVIDUALS INITIATED ACCIDENT', 'ACCIDENT HAS_CONSEQUENCE SUICIDE',
                               'EPIDEMIC DEATHS_NUMBER QUANTITY_FUZZY',
                               'CBRN_EVENT HAS_CONSEQUENCE ILLEGAL_CIVIL_DEMONSTRATION',
                               'NON_GOVERNMENTAL_ORGANISATION IS_AT_ODDS_WITH TERRORIST_OR_CRIMINAL',
                               'ECONOMICAL_CRISIS START_DATE TIME_FUZZY',
                               'NATURAL_EVENT DEATHS_NUMBER QUANTITY_EXACT', 'GATHERING END_DATE TIME_MAX',
                               'TERRORIST_OR_CRIMINAL HAS_CATEGORY CATEGORY',
                               'GROUP_OF_INDIVIDUALS HAS_CONTROL_OVER GROUP_OF_INDIVIDUALS',
                               'ACCIDENT END_DATE TIME_FUZZY', 'CIVILIAN DIED_IN NATURAL_CAUSES_DEATH',
                               'CIVILIAN HAS_CONTROL_OVER NON_GOVERNMENTAL_ORGANISATION',
                               'MILITARY IS_IN_CONTACT_WITH MILITARY',
                               'GROUP_OF_INDIVIDUALS IS_PART_OF NON_GOVERNMENTAL_ORGANISATION',
                               'NON_GOVERNMENTAL_ORGANISATION IS_PART_OF NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'NON_GOVERNMENTAL_ORGANISATION IS_PART_OF NON_GOVERNMENTAL_ORGANISATION',
                               'RIOT END_DATE TIME_EXACT', 'TERRORIST_OR_CRIMINAL DIED_IN FIRE',
                               'RIOT STARTED_IN PLACE',
                               'HOOLIGANISM_TROUBLEMAKING HAS_CONSEQUENCE HOOLIGANISM_TROUBLEMAKING',
                               'SUICIDE START_DATE TIME_FUZZY', 'ECONOMICAL_CRISIS HAS_CONSEQUENCE GATHERING',
                               'DRUG_OPERATION HAS_CONSEQUENCE DRUG_OPERATION', 'CIVILIAN INITIATED ACCIDENT',
                               'HOOLIGANISM_TROUBLEMAKING START_DATE TIME_MIN', 'CIVILIAN RESIDES_IN PLACE',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_IN_CONTACT_WITH CIVILIAN',
                               'AGITATING_TROUBLE_MAKING INJURED_NUMBER QUANTITY_EXACT',
                               'TERRORIST_OR_CRIMINAL IS_IN_CONTACT_WITH CIVILIAN',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_COOPERATING_WITH MILITARY_ORGANISATION',
                               'NATURAL_EVENT INJURED_NUMBER QUANTITY_FUZZY', 'THEFT START_DATE TIME_EXACT',
                               'STRIKE START_DATE TIME_EXACT', 'POLLUTION STARTED_IN PLACE',
                               'CIVILIAN INITIATED FIRE', 'CIVILIAN CREATED MATERIEL',
                               'TERRORIST_OR_CRIMINAL IS_AT_ODDS_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'DEMONSTRATION START_DATE TIME_EXACT', 'GROUP_OF_INDIVIDUALS INITIATED THEFT',
                               'DEMONSTRATION HAS_CONSEQUENCE ACCIDENT',
                               'MILITARY_ORGANISATION IS_COOPERATING_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'NON_GOVERNMENTAL_ORGANISATION WAS_DISSOLVED_IN TIME_EXACT',
                               'CIVILIAN IS_PART_OF INTERGOVERNMENTAL_ORGANISATION',
                               'RIOT INJURED_NUMBER QUANTITY_EXACT', 'TRAFFICKING STARTED_IN PLACE',
                               'TERRORIST_OR_CRIMINAL GENDER_MALE TERRORIST_OR_CRIMINAL',
                               'NON_GOVERNMENTAL_ORGANISATION HAS_CONTROL_OVER NON_GOVERNMENTAL_ORGANISATION',
                               'CBRN_EVENT START_DATE TIME_EXACT', 'PLACE HAS_LONGITUDE LONGITUDE',
                               'STRIKE END_DATE TIME_MAX', 'GROUP_OF_INDIVIDUALS INITIATED POLLUTION',
                               'AGITATING_TROUBLE_MAKING HAS_CONSEQUENCE CBRN_EVENT',
                               'TERRORIST_OR_CRIMINAL HAS_CONTROL_OVER CIVILIAN', 'CIVILIAN DIED_IN RIOT',
                               'TERRORIST_OR_CRIMINAL HAS_CONTROL_OVER MATERIEL',
                               'CRIMINAL_ARREST HAS_CONSEQUENCE GATHERING',
                               'NON_GOVERNMENTAL_ORGANISATION IS_AT_ODDS_WITH MILITARY',
                               'MILITARY_ORGANISATION IS_AT_ODDS_WITH GROUP_OF_INDIVIDUALS',
                               'MILITARY IS_AT_ODDS_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'MILITARY IS_AT_ODDS_WITH TERRORIST_OR_CRIMINAL',
                               'ELECTION HAS_CONSEQUENCE POLITICAL_VIOLENCE',
                               'DRUG_OPERATION HAS_CONSEQUENCE CIVIL_WAR_OUTBREAK',
                               'PLACE IS_OF_NATIONALITY NATIONALITY', 'MILITARY INITIATED CRIMINAL_ARREST',
                               'ECONOMICAL_CRISIS STARTED_IN PLACE', 'FIRE START_DATE TIME_MIN',
                               'GROUP_OF_INDIVIDUALS END_DATE TIME_EXACT', 'ELECTION START_DATE TIME_FUZZY',
                               'GATHERING HAS_CONSEQUENCE CBRN_EVENT', 'NATURAL_CAUSES_DEATH IS_LOCATED_IN PLACE',
                               'CIVIL_WAR_OUTBREAK INJURED_NUMBER QUANTITY_EXACT',
                               'STRIKE HAS_CONSEQUENCE GATHERING', 'EPIDEMIC HAS_CONSEQUENCE EPIDEMIC',
                               'DEMONSTRATION IS_LOCATED_IN PLACE',
                               'GROUP_OF_INDIVIDUALS HAS_CONTROL_OVER NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'STRIKE HAS_CONSEQUENCE ACCIDENT',
                               'ILLEGAL_CIVIL_DEMONSTRATION START_DATE TIME_EXACT', 'EPIDEMIC STARTED_IN PLACE',
                               'POLLUTION HAS_CONSEQUENCE ACCIDENT', 'FIRE START_DATE TIME_EXACT',
                               'ELECTION HAS_CONSEQUENCE CRIMINAL_ARREST', 'CBRN_EVENT HAS_CONSEQUENCE CBRN_EVENT',
                               'FIRE INJURED_NUMBER QUANTITY_EXACT', 'DEMONSTRATION HAS_CONSEQUENCE FIRE',
                               'ACCIDENT HAS_CONSEQUENCE THEFT', 'FIRE HAS_CONSEQUENCE CBRN_EVENT',
                               'ELECTION HAS_CONSEQUENCE GATHERING',
                               'MILITARY_ORGANISATION HAS_CONTROL_OVER NON_GOVERNMENTAL_ORGANISATION',
                               'FIRE DEATHS_NUMBER QUANTITY_EXACT',
                               'MILITARY HAS_CONTROL_OVER GROUP_OF_INDIVIDUALS',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION HAS_CONTROL_OVER MILITARY_ORGANISATION',
                               'CIVILIAN IS_AT_ODDS_WITH CIVILIAN', 'GATHERING END_DATE TIME_FUZZY',
                               'TERRORIST_OR_CRIMINAL IS_IN_CONTACT_WITH GROUP_OF_INDIVIDUALS',
                               'FIRE HAS_CONSEQUENCE POLLUTION', 'SUICIDE DEATHS_NUMBER QUANTITY_EXACT',
                               'GROUP_OF_INDIVIDUALS IS_IN_CONTACT_WITH MILITARY_ORGANISATION',
                               'TERRORIST_OR_CRIMINAL IS_IN_CONTACT_WITH TERRORIST_OR_CRIMINAL',
                               'MILITARY CREATED MATERIEL', 'EPIDEMIC START_DATE TIME_EXACT',
                               'PLACE HAS_CONTROL_OVER MATERIEL',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_OF_SIZE QUANTITY_MIN',
                               'BOMBING START_DATE TIME_FUZZY', 'RIOT END_DATE TIME_MAX',
                               'INTERGOVERNMENTAL_ORGANISATION IS_IN_CONTACT_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'RIOT START_DATE TIME_FUZZY', 'POLITICAL_VIOLENCE STARTED_IN PLACE',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_IN_CONTACT_WITH GROUP_OF_INDIVIDUALS',
                               'ACCIDENT START_DATE TIME_EXACT', 'EPIDEMIC END_DATE TIME_MAX',
                               'CIVILIAN INITIATED ILLEGAL_CIVIL_DEMONSTRATION',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION HAS_CONTROL_OVER GROUP_OF_INDIVIDUALS',
                               'TERRORIST_OR_CRIMINAL IS_AT_ODDS_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_COOPERATING_WITH MILITARY',
                               'EPIDEMIC HAS_CONSEQUENCE BOMBING', 'TERRORIST_OR_CRIMINAL INITIATED SUICIDE',
                               'ECONOMICAL_CRISIS HAS_CONSEQUENCE STRIKE', 'SUICIDE START_DATE TIME_EXACT',
                               'CIVILIAN IS_PART_OF MILITARY_ORGANISATION', 'COUP_D_ETAT HAS_CONSEQUENCE BOMBING',
                               'THEFT HAS_CONSEQUENCE TRAFFICKING',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION HAS_CONTROL_OVER NON_GOVERNMENTAL_ORGANISATION',
                               'GATHERING HAS_CONSEQUENCE ECONOMICAL_CRISIS', 'THEFT START_DATE TIME_FUZZY',
                               'STRIKE HAS_CONSEQUENCE CRIMINAL_ARREST',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION HAS_CONTROL_OVER MATERIEL',
                               'GROUP_OF_INDIVIDUALS HAS_CONTROL_OVER TERRORIST_OR_CRIMINAL',
                               'DEMONSTRATION HAS_CONSEQUENCE RIOT',
                               'NON_GOVERNMENTAL_ORGANISATION INITIATED THEFT',
                               'GATHERING HAS_CONSEQUENCE POLITICAL_VIOLENCE',
                               'CIVILIAN IS_COOPERATING_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'DEMONSTRATION INJURED_NUMBER QUANTITY_EXACT',
                               'NON_GOVERNMENTAL_ORGANISATION IS_COOPERATING_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'MILITARY_ORGANISATION IS_IN_CONTACT_WITH CIVILIAN',
                               'TERRORIST_OR_CRIMINAL CREATED MATERIEL', 'RIOT START_DATE TIME_MIN',
                               'MILITARY_ORGANISATION IS_AT_ODDS_WITH MILITARY_ORGANISATION',
                               'GROUP_OF_INDIVIDUALS IS_COOPERATING_WITH INTERGOVERNMENTAL_ORGANISATION',
                               'TERRORIST_OR_CRIMINAL IS_DEAD_ON TIME_EXACT',
                               'NON_GOVERNMENTAL_ORGANISATION INITIATED AGITATING_TROUBLE_MAKING',
                               'CIVILIAN DIED_IN ACCIDENT', 'MILITARY IS_OF_NATIONALITY NATIONALITY',
                               'FIRE HAS_CONSEQUENCE RIOT', 'MILITARY IS_AT_ODDS_WITH CIVILIAN',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION INITIATED DEMONSTRATION',
                               'NON_GOVERNMENTAL_ORGANISATION IS_COOPERATING_WITH GROUP_OF_INDIVIDUALS',
                               'NON_GOVERNMENTAL_ORGANISATION INITIATED TRAFFICKING',
                               'GATHERING HAS_CONSEQUENCE GATHERING',
                               'CRIMINAL_ARREST HAS_CONSEQUENCE POLITICAL_VIOLENCE',
                               'BOMBING HAS_CONSEQUENCE GATHERING', 'ECONOMICAL_CRISIS HAS_CONSEQUENCE RIOT',
                               'NATURAL_EVENT END_DATE TIME_MIN', 'EPIDEMIC HAS_CONSEQUENCE ECONOMICAL_CRISIS',
                               'CIVIL_WAR_OUTBREAK DEATHS_NUMBER QUANTITY_FUZZY', 'MILITARY INITIATED COUP_D_ETAT',
                               'NATURAL_CAUSES_DEATH START_DATE TIME_EXACT',
                               'ACCIDENT INJURED_NUMBER QUANTITY_FUZZY', 'GATHERING START_DATE TIME_FUZZY',
                               'STRIKE IS_LOCATED_IN PLACE', 'ACCIDENT END_DATE TIME_EXACT',
                               'FIRE END_DATE TIME_MAX', 'NON_MILITARY_GOVERNMENT_ORGANISATION OPERATES_IN PLACE',
                               'HOOLIGANISM_TROUBLEMAKING STARTED_IN PLACE', 'ELECTION END_DATE TIME_FUZZY',
                               'GROUP_OF_INDIVIDUALS INITIATED POLITICAL_VIOLENCE',
                               'GROUP_OF_INDIVIDUALS IS_OF_SIZE QUANTITY_MAX',
                               'ECONOMICAL_CRISIS START_DATE TIME_EXACT', 'THEFT END_DATE TIME_FUZZY',
                               'CIVILIAN DIED_IN SUICIDE', 'MILITARY HAS_CONTROL_OVER MILITARY_ORGANISATION',
                               'FIRE DEATHS_NUMBER QUANTITY_FUZZY', 'POLITICAL_VIOLENCE START_DATE TIME_FUZZY',
                               'MILITARY_ORGANISATION OPERATES_IN PLACE', 'GATHERING END_DATE TIME_EXACT',
                               'MILITARY_ORGANISATION HAS_CONTROL_OVER MILITARY', 'CBRN_EVENT END_DATE TIME_FUZZY',
                               'CRIMINAL_ARREST HAS_CONSEQUENCE DRUG_OPERATION', 'SUICIDE IS_LOCATED_IN PLACE',
                               'TERRORIST_OR_CRIMINAL IS_OF_NATIONALITY NATIONALITY',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_PART_OF NON_GOVERNMENTAL_ORGANISATION',
                               'POLLUTION DEATHS_NUMBER QUANTITY_FUZZY',
                               'TERRORIST_OR_CRIMINAL IS_IN_CONTACT_WITH MILITARY_ORGANISATION',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION INITIATED ECONOMICAL_CRISIS',
                               'ELECTION START_DATE TIME_EXACT', 'CIVIL_WAR_OUTBREAK IS_LOCATED_IN PLACE',
                               'ELECTION END_DATE TIME_MAX',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_AT_ODDS_WITH GROUP_OF_INDIVIDUALS',
                               'DRUG_OPERATION IS_LOCATED_IN PLACE',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION HAS_CONTROL_OVER NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'MILITARY DIED_IN CIVIL_WAR_OUTBREAK',
                               'NON_GOVERNMENTAL_ORGANISATION IS_OF_NATIONALITY NATIONALITY',
                               'POLITICAL_VIOLENCE IS_LOCATED_IN PLACE', 'NATURAL_CAUSES_DEATH END_DATE TIME_EXACT',
                               'STRIKE INJURED_NUMBER QUANTITY_FUZZY', 'THEFT HAS_CONSEQUENCE POLITICAL_VIOLENCE',
                               'NON_GOVERNMENTAL_ORGANISATION INITIATED GATHERING',
                               'GROUP_OF_INDIVIDUALS INITIATED CRIMINAL_ARREST', 'CIVILIAN DIED_IN COUP_D_ETAT',
                               'MATERIEL HAS_FOR_LENGTH LENGTH', 'NATURAL_EVENT END_DATE TIME_EXACT',
                               'ACCIDENT DEATHS_NUMBER QUANTITY_EXACT', 'GATHERING HAS_CONSEQUENCE CRIMINAL_ARREST',
                               'TERRORIST_OR_CRIMINAL IS_PART_OF MILITARY_ORGANISATION',
                               'ELECTION STARTED_IN PLACE', 'RIOT HAS_CONSEQUENCE CIVIL_WAR_OUTBREAK',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION HAS_CONTROL_OVER CIVILIAN',
                               'GROUP_OF_INDIVIDUALS HAS_CONTROL_OVER MILITARY',
                               'NON_GOVERNMENTAL_ORGANISATION HAS_CONTROL_OVER PLACE',
                               'ECONOMICAL_CRISIS HAS_CONSEQUENCE COUP_D_ETAT',
                               'GATHERING HAS_CONSEQUENCE EPIDEMIC', 'CIVILIAN DIED_IN BOMBING',
                               'TERRORIST_OR_CRIMINAL HAS_CONTROL_OVER NON_GOVERNMENTAL_ORGANISATION',
                               'NATURAL_EVENT HAS_CONSEQUENCE ACCIDENT',
                               'TERRORIST_OR_CRIMINAL IS_AT_ODDS_WITH GROUP_OF_INDIVIDUALS',
                               'RIOT DEATHS_NUMBER QUANTITY_MIN', 'GATHERING IS_LOCATED_IN PLACE',
                               'NATURAL_CAUSES_DEATH HAS_CONSEQUENCE GATHERING', 'ACCIDENT END_DATE TIME_MIN',
                               'THEFT HAS_CONSEQUENCE ACCIDENT', 'BOMBING HAS_CONSEQUENCE THEFT',
                               'NON_GOVERNMENTAL_ORGANISATION IS_COOPERATING_WITH CIVILIAN',
                               'THEFT HAS_CONSEQUENCE ILLEGAL_CIVIL_DEMONSTRATION',
                               'CIVIL_WAR_OUTBREAK HAS_CONSEQUENCE CIVIL_WAR_OUTBREAK',
                               'CIVILIAN IS_DEAD_ON TIME_FUZZY',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION INITIATED POLITICAL_VIOLENCE',
                               'CIVILIAN IS_COOPERATING_WITH GROUP_OF_INDIVIDUALS',
                               'CRIMINAL_ARREST HAS_CONSEQUENCE CRIMINAL_ARREST',
                               'DEMONSTRATION HAS_CONSEQUENCE AGITATING_TROUBLE_MAKING',
                               'ILLEGAL_CIVIL_DEMONSTRATION HAS_CONSEQUENCE CRIMINAL_ARREST',
                               'BOMBING END_DATE TIME_EXACT', 'NATURAL_EVENT END_DATE TIME_MAX',
                               'TRAFFICKING HAS_CONSEQUENCE THEFT', 'DRUG_OPERATION START_DATE TIME_EXACT',
                               'NATURAL_EVENT INJURED_NUMBER QUANTITY_EXACT', 'CIVILIAN HAS_CATEGORY CATEGORY',
                               'TERRORIST_OR_CRIMINAL INITIATED THEFT', 'CBRN_EVENT HAS_CONSEQUENCE EPIDEMIC',
                               'EPIDEMIC END_DATE TIME_FUZZY', 'GROUP_OF_INDIVIDUALS DEATHS_NUMBER QUANTITY_FUZZY',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_LOCATED_IN PLACE',
                               'BOMBING START_DATE TIME_EXACT',
                               'ECONOMICAL_CRISIS HAS_CONSEQUENCE ECONOMICAL_CRISIS',
                               'TRAFFICKING END_DATE TIME_EXACT', 'FIRE END_DATE TIME_EXACT',
                               'NATURAL_CAUSES_DEATH START_DATE TIME_MIN',
                               'MILITARY_ORGANISATION IS_AT_ODDS_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'GATHERING HAS_CONSEQUENCE ACCIDENT', 'CIVILIAN INITIATED STRIKE',
                               'TERRORIST_OR_CRIMINAL IS_PART_OF GROUP_OF_INDIVIDUALS',
                               'MILITARY IS_PART_OF NON_GOVERNMENTAL_ORGANISATION',
                               'COUP_D_ETAT HAS_CONSEQUENCE CRIMINAL_ARREST',
                               'CIVILIAN IS_IN_CONTACT_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'MILITARY RESIDES_IN PLACE', 'BOMBING IS_LOCATED_IN PLACE',
                               'EPIDEMIC HAS_CONSEQUENCE DEMONSTRATION',
                               'NON_GOVERNMENTAL_ORGANISATION INITIATED DEMONSTRATION',
                               'ACCIDENT IS_LOCATED_IN PLACE', 'CBRN_EVENT HAS_CONSEQUENCE NATURAL_EVENT',
                               'DEMONSTRATION HAS_CONSEQUENCE POLITICAL_VIOLENCE',
                               'GROUP_OF_INDIVIDUALS INITIATED CIVIL_WAR_OUTBREAK',
                               'NATURAL_CAUSES_DEATH END_DATE TIME_MIN',
                               'TERRORIST_OR_CRIMINAL HAS_CONTROL_OVER GROUP_OF_INDIVIDUALS',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION INITIATED CIVIL_WAR_OUTBREAK',
                               'HOOLIGANISM_TROUBLEMAKING END_DATE TIME_EXACT',
                               'DRUG_OPERATION END_DATE TIME_EXACT',
                               'NON_GOVERNMENTAL_ORGANISATION CREATED MATERIEL',
                               'AGITATING_TROUBLE_MAKING HAS_CONSEQUENCE CIVIL_WAR_OUTBREAK',
                               'GATHERING END_DATE TIME_MIN', 'RIOT HAS_CONSEQUENCE CRIMINAL_ARREST',
                               'GATHERING START_DATE TIME_MIN', 'MILITARY IS_AT_ODDS_WITH GROUP_OF_INDIVIDUALS',
                               'TERRORIST_OR_CRIMINAL IS_IN_CONTACT_WITH MILITARY',
                               'COUP_D_ETAT END_DATE TIME_FUZZY', 'ELECTION HAS_CONSEQUENCE DEMONSTRATION',
                               'TERRORIST_OR_CRIMINAL IS_COOPERATING_WITH GROUP_OF_INDIVIDUALS',
                               'POLITICAL_VIOLENCE HAS_CONSEQUENCE FIRE', 'GROUP_OF_INDIVIDUALS INITIATED STRIKE',
                               'COUP_D_ETAT HAS_CONSEQUENCE DEMONSTRATION', 'ECONOMICAL_CRISIS IS_LOCATED_IN PLACE',
                               'DEMONSTRATION START_DATE TIME_FUZZY',
                               'MILITARY IS_IN_CONTACT_WITH GROUP_OF_INDIVIDUALS',
                               'CIVILIAN IS_AT_ODDS_WITH TERRORIST_OR_CRIMINAL',
                               'ELECTION HAS_CONSEQUENCE ELECTION',
                               'NON_GOVERNMENTAL_ORGANISATION IS_IN_CONTACT_WITH TERRORIST_OR_CRIMINAL',
                               'NATURAL_EVENT START_DATE TIME_FUZZY',
                               'INTERGOVERNMENTAL_ORGANISATION IS_COOPERATING_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'NON_GOVERNMENTAL_ORGANISATION IS_AT_ODDS_WITH MILITARY_ORGANISATION',
                               'CIVILIAN IS_COOPERATING_WITH MILITARY', 'THEFT HAS_CONSEQUENCE DRUG_OPERATION',
                               'MILITARY IS_LOCATED_IN PLACE', 'CIVILIAN INITIATED TRAFFICKING',
                               'FIRE HAS_CONSEQUENCE CRIMINAL_ARREST', 'CIVILIAN GENDER_MALE CIVILIAN',
                               'GROUP_OF_INDIVIDUALS IS_AT_ODDS_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'NATURAL_CAUSES_DEATH START_DATE TIME_FUZZY', 'CIVILIAN IS_DEAD_ON TIME_EXACT',
                               'CIVILIAN GENDER_FEMALE CIVILIAN', 'RIOT DEATHS_NUMBER QUANTITY_EXACT',
                               'CIVILIAN IS_BORN_IN PLACE', 'FIRE HAS_CONSEQUENCE ACCIDENT',
                               'RIOT HAS_CONSEQUENCE RIOT', 'CIVILIAN IS_AT_ODDS_WITH GROUP_OF_INDIVIDUALS',
                               'GATHERING HAS_CONSEQUENCE NATURAL_CAUSES_DEATH',
                               'GROUP_OF_INDIVIDUALS START_DATE TIME_EXACT',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION INITIATED CRIMINAL_ARREST',
                               'ECONOMICAL_CRISIS END_DATE TIME_EXACT',
                               'DRUG_OPERATION HAS_CONSEQUENCE TRAFFICKING', 'COUP_D_ETAT IS_LOCATED_IN PLACE',
                               'GROUP_OF_INDIVIDUALS INITIATED GATHERING',
                               'NON_GOVERNMENTAL_ORGANISATION INITIATED CBRN_EVENT',
                               'TERRORIST_OR_CRIMINAL IS_BORN_IN PLACE', 'EPIDEMIC INJURED_NUMBER QUANTITY_EXACT',
                               'NATURAL_EVENT HAS_CONSEQUENCE CBRN_EVENT',
                               'GROUP_OF_INDIVIDUALS IS_IN_CONTACT_WITH TERRORIST_OR_CRIMINAL',
                               'COUP_D_ETAT START_DATE TIME_FUZZY', 'TERRORIST_OR_CRIMINAL INITIATED COUP_D_ETAT',
                               'INTERGOVERNMENTAL_ORGANISATION HAS_CONTROL_OVER MATERIEL',
                               'NATURAL_EVENT HAS_CONSEQUENCE NATURAL_CAUSES_DEATH',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_IN_CONTACT_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'ILLEGAL_CIVIL_DEMONSTRATION END_DATE TIME_FUZZY', 'PLACE IS_LOCATED_IN PLACE',
                               'CIVILIAN HAS_FAMILY_RELATIONSHIP TERRORIST_OR_CRIMINAL', 'FIRE END_DATE TIME_MIN',
                               'MILITARY IS_IN_CONTACT_WITH NON_GOVERNMENTAL_ORGANISATION',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION HAS_CONTROL_OVER TERRORIST_OR_CRIMINAL',
                               'DEMONSTRATION END_DATE TIME_FUZZY',
                               'INTERGOVERNMENTAL_ORGANISATION IS_IN_CONTACT_WITH CIVILIAN',
                               'INTERGOVERNMENTAL_ORGANISATION IS_COOPERATING_WITH GROUP_OF_INDIVIDUALS',
                               'GROUP_OF_INDIVIDUALS HAS_CONTROL_OVER MILITARY_ORGANISATION',
                               'CIVILIAN INITIATED CIVIL_WAR_OUTBREAK',
                               'NON_GOVERNMENTAL_ORGANISATION HAS_CONTROL_OVER INTERGOVERNMENTAL_ORGANISATION',
                               'NON_GOVERNMENTAL_ORGANISATION CREATED NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'RIOT HAS_CONSEQUENCE FIRE',
                               'NON_GOVERNMENTAL_ORGANISATION HAS_CONTROL_OVER NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'CIVIL_WAR_OUTBREAK START_DATE TIME_FUZZY',
                               'CIVILIAN IS_PART_OF NON_GOVERNMENTAL_ORGANISATION',
                               'CIVILIAN HAS_CONTROL_OVER CIVILIAN', 'CBRN_EVENT START_DATE TIME_FUZZY',
                               'ECONOMICAL_CRISIS HAS_CONSEQUENCE BOMBING',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_IN_CONTACT_WITH INTERGOVERNMENTAL_ORGANISATION',
                               'CIVILIAN HAS_CONTROL_OVER TERRORIST_OR_CRIMINAL',
                               'MATERIEL HAS_QUANTITY QUANTITY_MIN', 'CIVILIAN INITIATED GATHERING',
                               'GROUP_OF_INDIVIDUALS CREATED MATERIEL', 'COUP_D_ETAT START_DATE TIME_EXACT',
                               'POLITICAL_VIOLENCE HAS_CONSEQUENCE CRIMINAL_ARREST',
                               'NON_GOVERNMENTAL_ORGANISATION HAS_CONTROL_OVER GROUP_OF_INDIVIDUALS',
                               'STRIKE STARTED_IN PLACE', 'GROUP_OF_INDIVIDUALS IS_OF_SIZE QUANTITY_MIN',
                               'DEMONSTRATION END_DATE TIME_EXACT',
                               'NON_GOVERNMENTAL_ORGANISATION IS_OF_SIZE QUANTITY_FUZZY',
                               'NATURAL_EVENT HAS_CONSEQUENCE NATURAL_EVENT', 'CBRN_EVENT HAS_CONSEQUENCE ACCIDENT',
                               'TRAFFICKING HAS_CONSEQUENCE TRAFFICKING',
                               'NON_GOVERNMENTAL_ORGANISATION INITIATED FIRE',
                               'MILITARY_ORGANISATION IS_AT_ODDS_WITH INTERGOVERNMENTAL_ORGANISATION',
                               'FIRE END_DATE TIME_FUZZY', 'CRIMINAL_ARREST DEATHS_NUMBER QUANTITY_EXACT',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION INITIATED RIOT', 'THEFT START_DATE TIME_MIN',
                               'POLLUTION END_DATE TIME_EXACT', 'BOMBING HAS_CONSEQUENCE CBRN_EVENT',
                               'EPIDEMIC HAS_CONSEQUENCE GATHERING', 'RIOT IS_LOCATED_IN PLACE',
                               'NON_GOVERNMENTAL_ORGANISATION IS_AT_ODDS_WITH GROUP_OF_INDIVIDUALS',
                               'ILLEGAL_CIVIL_DEMONSTRATION STARTED_IN PLACE',
                               'NON_GOVERNMENTAL_ORGANISATION IS_PART_OF GROUP_OF_INDIVIDUALS',
                               'TRAFFICKING HAS_CONSEQUENCE DRUG_OPERATION', 'CIVILIAN IS_BORN_ON TIME_EXACT',
                               'ECONOMICAL_CRISIS HAS_CONSEQUENCE THEFT',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_IN_CONTACT_WITH MILITARY_ORGANISATION',
                               'TRAFFICKING IS_LOCATED_IN PLACE', 'MATERIEL WEIGHS WEIGHT',
                               'ELECTION HAS_CONSEQUENCE FIRE', 'ACCIDENT HAS_CONSEQUENCE FIRE',
                               'GROUP_OF_INDIVIDUALS HAS_CONTROL_OVER CIVILIAN',
                               'GATHERING HAS_CONSEQUENCE DEMONSTRATION',
                               'TERRORIST_OR_CRIMINAL IS_AT_ODDS_WITH CIVILIAN', 'EPIDEMIC START_DATE TIME_MIN',
                               'GROUP_OF_INDIVIDUALS INITIATED ILLEGAL_CIVIL_DEMONSTRATION',
                               'MILITARY IS_PART_OF NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'COUP_D_ETAT END_DATE TIME_EXACT', 'AGITATING_TROUBLE_MAKING STARTED_IN PLACE',
                               'GROUP_OF_INDIVIDUALS IS_PART_OF MILITARY_ORGANISATION',
                               'GROUP_OF_INDIVIDUALS INITIATED HOOLIGANISM_TROUBLEMAKING',
                               'ELECTION HAS_CONSEQUENCE ACCIDENT', 'CIVILIAN INITIATED POLLUTION',
                               'CIVILIAN IS_OF_NATIONALITY NATIONALITY', 'CRIMINAL_ARREST START_DATE TIME_FUZZY',
                               'DRUG_OPERATION HAS_CONSEQUENCE AGITATING_TROUBLE_MAKING',
                               'HOOLIGANISM_TROUBLEMAKING HAS_CONSEQUENCE CRIMINAL_ARREST',
                               'MILITARY_ORGANISATION IS_AT_ODDS_WITH CIVILIAN',
                               'CIVILIAN IS_IN_CONTACT_WITH MILITARY',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION CREATED MATERIEL',
                               'MILITARY_ORGANISATION IS_OF_NATIONALITY NATIONALITY',
                               'MILITARY HAS_CONTROL_OVER NON_GOVERNMENTAL_ORGANISATION',
                               'AGITATING_TROUBLE_MAKING HAS_CONSEQUENCE AGITATING_TROUBLE_MAKING',
                               'POLLUTION HAS_CONSEQUENCE EPIDEMIC', 'POLITICAL_VIOLENCE HAS_CONSEQUENCE THEFT',
                               'BOMBING HAS_CONSEQUENCE BOMBING',
                               'GROUP_OF_INDIVIDUALS IS_IN_CONTACT_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION STARTED_IN PLACE',
                               'CBRN_EVENT HAS_CONSEQUENCE DEMONSTRATION', 'GATHERING START_DATE TIME_MAX',
                               'TERRORIST_OR_CRIMINAL RESIDES_IN PLACE', 'MATERIEL WAS_CREATED_IN TIME_EXACT',
                               'TRAFFICKING HAS_CONSEQUENCE FIRE', 'CRIMINAL_ARREST IS_LOCATED_IN PLACE',
                               'TRAFFICKING HAS_CONSEQUENCE NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'MILITARY_ORGANISATION HAS_CONTROL_OVER MATERIEL',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_IN_CONTACT_WITH TERRORIST_OR_CRIMINAL',
                               'MILITARY_ORGANISATION INITIATED CRIMINAL_ARREST',
                               'GROUP_OF_INDIVIDUALS IS_AT_ODDS_WITH MILITARY_ORGANISATION',
                               'GATHERING HAS_CONSEQUENCE THEFT', 'MILITARY HAS_CONTROL_OVER PLACE',
                               'GROUP_OF_INDIVIDUALS IS_PART_OF NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'AGITATING_TROUBLE_MAKING START_DATE TIME_FUZZY',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_PART_OF NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'NATURAL_CAUSES_DEATH END_DATE TIME_FUZZY', 'NATURAL_EVENT START_DATE TIME_MAX',
                               'GROUP_OF_INDIVIDUALS IS_IN_CONTACT_WITH MILITARY', 'MATERIEL HAS_FOR_HEIGHT HEIGHT',
                               'CBRN_EVENT DEATHS_NUMBER QUANTITY_EXACT', 'CIVILIAN DIED_IN FIRE',
                               'CIVIL_WAR_OUTBREAK HAS_CONSEQUENCE FIRE',
                               'TERRORIST_OR_CRIMINAL HAS_CONTROL_OVER PLACE', 'FIRE HAS_CONSEQUENCE GATHERING',
                               'ACCIDENT HAS_CONSEQUENCE CRIMINAL_ARREST',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_OF_SIZE QUANTITY_FUZZY',
                               'CIVILIAN DIED_IN THEFT', 'ACCIDENT HAS_CONSEQUENCE ACCIDENT',
                               'TERRORIST_OR_CRIMINAL HAS_FAMILY_RELATIONSHIP TERRORIST_OR_CRIMINAL',
                               'STRIKE DEATHS_NUMBER QUANTITY_EXACT', 'STRIKE HAS_CONSEQUENCE FIRE',
                               'EPIDEMIC START_DATE TIME_FUZZY', 'ELECTION IS_LOCATED_IN PLACE',
                               'AGITATING_TROUBLE_MAKING DEATHS_NUMBER QUANTITY_EXACT',
                               'GROUP_OF_INDIVIDUALS HAS_CONTROL_OVER NON_GOVERNMENTAL_ORGANISATION',
                               'EPIDEMIC END_DATE TIME_EXACT', 'COUP_D_ETAT DEATHS_NUMBER QUANTITY_FUZZY',
                               'GROUP_OF_INDIVIDUALS IS_COOPERATING_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'HOOLIGANISM_TROUBLEMAKING IS_LOCATED_IN PLACE', 'THEFT START_DATE TIME_MAX',
                               'THEFT HAS_CONSEQUENCE CIVIL_WAR_OUTBREAK',
                               'NON_GOVERNMENTAL_ORGANISATION INITIATED COUP_D_ETAT',
                               'ILLEGAL_CIVIL_DEMONSTRATION START_DATE TIME_FUZZY', 'STRIKE HAS_CONSEQUENCE RIOT',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_COOPERATING_WITH INTERGOVERNMENTAL_ORGANISATION',
                               'DEMONSTRATION HAS_CONSEQUENCE CIVIL_WAR_OUTBREAK',
                               'CIVILIAN IS_AT_ODDS_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'NON_MILITARY_GOVERNMENT_ORGANISATION IS_COOPERATING_WITH NON_MILITARY_GOVERNMENT_ORGANISATION',
                               'INTERGOVERNMENTAL_ORGANISATION IS_AT_ODDS_WITH MILITARY_ORGANISATION',
                               'NON_GOVERNMENTAL_ORGANISATION INITIATED ILLEGAL_CIVIL_DEMONSTRATION',
                               'NATURAL_EVENT DEATHS_NUMBER QUANTITY_FUZZY', 'MILITARY HAS_CATEGORY CATEGORY',
                               'COUP_D_ETAT STARTED_IN PLACE', 'THEFT STARTED_IN PLACE']


def encode_entity(text, tokenized_text, entity, shift=0):
    text_without_spaces = text.replace(" ", "")
    encoded_entity = [0] * len(text_without_spaces)

    for mention in entity['mentions']:
        start_index = mention['start']
        end_index = mention['end']

        # There is cases where a new line is in the middle of the text
        shifted_start_index = start_index - (
                text[:start_index].count(" ") + text[:start_index].count("\n") + text[:start_index].count(" "))
        shifted_end_index = end_index - (
                text[:end_index].count(" ") + text[:end_index].count("\n") + text[:start_index].count(" "))

        for i in range(shifted_start_index, shifted_end_index):
            encoded_entity[i] = ENTITY_CLASSES.index(entity['type']) + shift

    compact_encoded_entity = []

    char_index = 0
    for token in tokenized_text:
        token_values = encoded_entity[char_index:char_index + len(token) - 2 * token.count("##")]

        if any(value != token_values[0] for value in token_values):
            raise ValueError(
                f"Conflicting values in token: '{token}':\n"
                f"{text}\n{tokenized_text}\n{encoded_entity}\n{compact_encoded_entity}\n{entity}")

        compact_encoded_entity.append(token_values[0])

        char_index += len(token) - 2 * token.count("##")

    return compact_encoded_entity


def split_dataset(arr, eval_ration=0.2):
    class_groups = defaultdict(list)
    for exemple in arr:
        class_groups[exemple[-1]].append(exemple)

    array1 = []
    array2 = []

    for cls, items in class_groups.items():
        half = int(len(items) * eval_ration)
        array1.extend(items[half:])
        array2.extend(items[:half])

    return array1, array2


def prepare_data(dataset_path, tokenizer):
    df = pd.read_csv(dataset_path)
    df = df.set_index("id")
    df.entities = df.entities.apply(json.loads)
    df.relations = df.relations.apply(json.loads)

    _all = []
    _seen = set()
    max_length = 0
    for index, row in df.iterrows():
        original_text = row["text"]
        cleaned_text = clean_text(row["text"])
        tokens = tokenizer.tokenize(cleaned_text)
        ids = tokenizer.encode(cleaned_text)
        if len(tokens) + 2 > max_length:
            max_length = len(tokens) + 2

        for first_entity in row['entities']:
            for second_entity in row['entities']:
                for relation in RELATION_CLASSES:
                    if f"{first_entity['type']} {relation} {second_entity['type']}" in POSSIBLE_ENTITIES_RELATIONS:
                        if [first_entity['id'], relation, second_entity['id']] in row['relations']:
                            target_relation = relation
                        else:
                            target_relation = 'NO_RELATION'

                        first_entity_encodings = encode_entity(original_text, tokens, first_entity)
                        second_entity_encodings = encode_entity(original_text, tokens, second_entity, shift=len(ENTITY_CLASSES))
                        merged_encodings = [0] + [max(x, y) for x, y in zip(first_entity_encodings, second_entity_encodings)] + [0]

                        # keep only unique combinations
                        enc = f"{index} {first_entity['id']} {second_entity['id']} {target_relation}"
                        if enc not in _seen:
                            _seen.add(enc)
                            _all.append([ids,
                                         merged_encodings,
                                         RELATION_CLASSES.index(target_relation)])

    deterministic_random = random.Random(42)
    deterministic_random.shuffle(_all)
    _train, _eval = split_dataset(_all, eval_ration=0.2)

    print(f"Train size: {len(_train)}")
    print(f"Eval size: {len(_eval)}")

    return _train, _eval, max_length


class TextMineDataset(Dataset):

    def __init__(self, data, tokenizer: BertTokenizer, max_length, upsample=False):
        self.pad_id = tokenizer._convert_token_to_id('[PAD]')
        self.max_length = max_length
        self.data = data

        self.upsample = upsample
        if upsample:
            self.classified_data = defaultdict(list)
            for exemple in data:
                self.classified_data[exemple[-1]].append(exemple)

            self.current_class = 0

    def __len__(self):
        return len(self.data)

    def __getitem__(self, index):
        if self.upsample:
            a = random.choice(self.classified_data[self.current_class % len(RELATION_CLASSES)])
            self.current_class += 1
        else:
            a = self.data[index]
        relation_class = a[-1]

        if len(a[0]) > self.max_length:
            raise ValueError(f"Lengths of sequences are greater than max_length: {len(a[0])}")

        padded_a = pad_sequence(a[:-1], self.max_length, self.pad_id)
        attention_mask = (torch.tensor(padded_a[0]) != self.pad_id)
        return torch.tensor(padded_a[0]), attention_mask, torch.tensor(padded_a[1]), relation_class
